<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-backstubber-Backstubber.html">Backstubber</a><ul class='methods'><li data-type='method'><a href="module-backstubber-Backstubber.html#all">all</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#delete">delete</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#get">get</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#head">head</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#listen">listen</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#mount">mount</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#post">post</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#proxy">proxy</a></li><li data-type='method'><a href="module-backstubber-Backstubber.html#put">put</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-backstubber.html">backstubber</a></li></ul>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>Backstubber</h1><p>Simple yet powerful backend stubs.</p>
<h2>Installation</h2><pre class="prettyprint source"><code>$ npm install backstubber</code></pre><p>Install globally with <code>npm install -g backstubber</code> to use the <code>backstubber</code> CLI binary.</p>
<h2>Features</h2><p>Backstubber lets you easily stub any JSON backend, e.g.:</p>
<ul>
<li>Serve JSON files directly from your file system</li>
<li>Generate dynamic data using functions</li>
<li>Merge actual service responses with your stubs, adding or modifying attributes</li>
</ul>
<h2>API docs</h2><p>You can find this README and the latest API docs at <a href="http://bcluca.github.io/backstubber">bcluca.github.io/backstubber</a>.</p>
<h2>Usage</h2><h4>As a library</h4><p>Create your app with <code>backstubber()</code> and mount your fake endpoints, optionally proxying all unhandled calls to a real service, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>var backstubber = require('backstubber');

backstubber()
    .mount(__dirname + '/simple')
    .mount(__dirname + '/merge', 'https://api.github.com')
    .mount(__dirname + '/form', 'http://httpbin.org')
    .proxy('*', 'https://api.github.com')
    .listen(3333);</code></pre><p>In each endpoint directory, create JSON or JavaScript files named after the HTTP verbs you want your service to respond to, e.g.:</p>
<pre class="prettyprint source"><code>example/
├── app.js
├── form
│   └── post
│       └── post.json
└── simple
    ├── faker
    │   └── get.js
    ├── hello
    │   └── get.json
    └── random
        └── get.js</code></pre><p>Example <code>get.json</code> defining a simple static stub:</p>
<pre class="prettyprint source lang-json"><code>{
    &quot;foo&quot; : &quot;bar&quot;
}</code></pre><p>The following example defines a dynamic stub that is merged on top of a real response from an external service:</p>
<pre class="prettyprint source lang-json"><code>{
    &quot;_$$&quot; : false,
    &quot;awesome&quot; : true,
    &quot;followers&quot; : 424242
}</code></pre><p>Original response from the external service:</p>
<pre class="prettyprint source lang-json"><code>{
    &quot;login&quot;: &quot;bcluca&quot;,
    &quot;url&quot;: &quot;https://api.github.com/users/bcluca&quot;,
    &quot;type&quot;: &quot;User&quot;,
    &quot;name&quot;: &quot;Luca Bernardo Ciddio&quot;,
    &quot;company&quot;: &quot;YellowPages.com&quot;,
    &quot;followers&quot;: 11
}</code></pre><p>Stubbed response:</p>
<pre class="prettyprint source lang-json"><code>{
    &quot;login&quot;: &quot;bcluca&quot;,
    &quot;url&quot;: &quot;https://api.github.com/users/bcluca&quot;,
    &quot;type&quot;: &quot;User&quot;,
    &quot;name&quot;: &quot;Luca Bernardo Ciddio&quot;,
    &quot;company&quot;: &quot;YellowPages.com&quot;,
    &quot;followers&quot;: 424242,
    &quot;awesome&quot;: true
}</code></pre><p>The <code>followers</code> attribute is modified and a new <code>awesome</code> attribute is added.</p>
<p>You can also stub individual routes inline, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>var backstubber = require('backstubber');

backstubber()
    .get('/foo/bar', { foo: 'bar' })
    .post('/test', { test: true })
    .all('/baz', { _$$: true, baz: true }, 'https://api.github.com')
    .listen(3333);</code></pre><h4>As a binary</h4><pre class="prettyprint source"><code>Usage: backstubber [options]

Options:

  -h, --help                        output usage information
  -V, --version                     output the version number
  -m, --mount &lt;dir[,service]>       mount stubs directory, with optional service
  -P, --proxy &lt;endpoint|*,service>  proxy unhandled calls (use * to catch all)
  -p, --port &lt;port>                 set the port (defaults to 3333)</code></pre><p>Examples:</p>
<pre class="prettyprint source"><code>$ backstubber -m example/simple
$ backstubber -m example/simple -m example/merge,https://api.github.com -p 8080
$ backstubber --mount=example/simple --port=3000
$ backstubber -m example/merge,https://api.github.com -P *,https://api.github.com</code></pre><h5>Note</h5><p>If you are using the <code>backstubber</code> binary and your stubs require any packages, make sure you have those installed either locally in any <code>node_modules</code> directory up the tree, or globally.</p>
<p>For instance, if you want to mount the stubs defined in <code>./example/simple/</code>, please run <code>npm install</code> or <code>npm install -g faker</code> first.</p>
<h2>Merging with <code>_$$</code></h2><p>If you add a service url to your <code>mount()</code> calls, your stub will proxy all calls to an actual service and merge the responses. In your endpoint file, you can reference the original response with the <code>_$$</code> attribute.</p>
<p>Setting <code>_$$</code> to a falsy value (e.g. <code>false</code> or <code>0</code>) merges your stub data on top of the original response. A truthy value (e.g. <code>true</code> or <code>1</code>) makes the original attributes &quot;win&quot; over your stub data.</p>
<p><code>_$$</code> is falsy by default, meaning that all stubs will overwrite the original response if no <code>_$$</code> attributes are present.</p>
<p>The <code>rate_limit</code> example illustrates the use of merging overrides:</p>
<pre class="prettyprint source lang-javascript"><code>module.exports = {
    _$$ : 1,              // original attrs merged over the stub
    resources : {
        _$$ : 1,          // same here
        search : {
            _$$ : 0,      // this allows the stub to overwrite foo and limit
            foo : 'bar',
            limit : 42
        },
        core : 42         // this gets replaced by the original core attr
    },
    rate : {
        _$$ : 0,          // limit will be 42 in the final response
        limit : 42
    }
};</code></pre><p><code>_$$</code> also works with arrays, e.g.:</p>
<pre class="prettyprint source lang-json"><code>[&quot;_$$&quot;, {
    &quot;foo&quot; : &quot;bar&quot;
}]</code></pre><p>You can remove attributes from the original response by setting them to <code>undefined</code>, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>module.exports = {
    _$$ : false,
    documentation_url : undefined           // this attr will be removed
};</code></pre><p>Note that this is only allowed in JavaScript stubs. If you are using JSON for your stubs and need this functionality, please use JavaScript instead.</p>
<p>You can also have full control over merging by referencing the original response inside functions, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>module.exports = {
    _$$ : true,                             // response data takes priority
    message : function (data) {             // custom merging, _$$ ignored
        return 'Original message: ' + data; // uses original attr data
    },
    documentation_url : 'new url'           // _$$ not ignored here
};</code></pre><p>Functions can also be used to define merging behavior, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>module.exports = {
    _$$ : function (data) {
        console.log(data);          // original data also available
        return Math.random() &lt; 0.5; // dynamic merge
    },
    message : 'Updated message'     // randomly merged
};</code></pre><h2>Request object</h2><p>In addition to the current <code>data</code> chunk, you can use the original request object <code>req</code> inside functions, e.g.:</p>
<pre class="prettyprint source lang-javascript"><code>module.exports = {
    userAgent : function (data, req) {
        return req.headers['user-agent'];
    },
    query : function (data, req) {
        return req.query;
    }
};</code></pre><h2>HTTP status codes</h2><p>When you interact with an external service, you can also restrict your stubs to specific HTTP status codes by adding a status prefix to your stub, e.g.:</p>
<pre class="prettyprint source"><code>example/status/
└── status
    └── :status
        ├── get.200.json
        ├── get.4xx.js
        └── get.json</code></pre><p>The <code>x</code> in the status code pattern will match any number.</p>
<p>Stubs with no status specified will be used as a fallback, when no specific status codes are matched. If no generic stubs are found, the request will be proxied to the external service, as usual.</p>
<p>In the example above you can also notice the use of parameters. Naming an endpoint directory with a leading colon, e.g. <code>:status</code>, will make that part of the actual URL available in <code>req.params</code>, e.g. <code>req.params.status</code>.</p>
<h2>Example app</h2><p>Run with:</p>
<pre class="prettyprint source"><code>$ node example/app.js</code></pre><p>Test endpoints:</p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET /hello</code></td>
<td>Simple <em>Hello!</em> message</td>
</tr>
<tr>
<td><code>GET /random</code></td>
<td>Dynamic output using functions</td>
</tr>
<tr>
<td><code>GET /faker</code></td>
<td>Example using Faker generators</td>
</tr>
<tr>
<td><code>GET /</code></td>
<td>Simple proxy to the github API</td>
</tr>
<tr>
<td><code>POST /post</code></td>
<td>Simple <code>POST</code> example</td>
</tr>
<tr>
<td><code>GET /orgs/github</code></td>
<td>Merging example using JavaScript</td>
</tr>
<tr>
<td><code>GET /users/bcluca</code></td>
<td>Merging example using JSON</td>
</tr>
<tr>
<td><code>GET /rate_limit</code></td>
<td>Example showing merging overrides</td>
</tr>
<tr>
<td><code>GET /users/bcluca/orgs</code></td>
<td>Array merging example</td>
</tr>
<tr>
<td><code>GET /fn</code></td>
<td>Using response data in functions</td>
</tr>
<tr>
<td><code>GET /events</code></td>
<td>Root handler example</td>
</tr>
<tr>
<td><code>GET /dynamic</code></td>
<td>Dynamic merging example</td>
</tr>
<tr>
<td><code>GET /req?foo=bar</code></td>
<td>Example using the request object</td>
</tr>
</tbody>
</table></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated at Sat Aug 15 2015 00:47:04 GMT-0700 (PDT)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>